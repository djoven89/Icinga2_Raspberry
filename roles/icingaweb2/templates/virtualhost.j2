## Forcing HTTPS

<VirtualHost *:80>
  RewriteEngine On
  RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

<VirtualHost _default_:443>
  DocumentRoot "/usr/share/icingaweb2/public"
  ServerName {{ site_domain }}
  DirectoryIndex index.html index.php

  ErrorLog ${APACHE_LOG_DIR}/https-{{ site_short_name }}_error.log
  CustomLog ${APACHE_LOG_DIR}/https-{{ site_short_name }}_access.log combined

  ## SSL configuration
  SSLEngine on
  SSLCertificateFile	{{ site_cert_file }}
  SSLCertificateKeyFile {{ site_cert_key }}

  <Directory "/usr/share/icingaweb2/public">
    Options SymLinksIfOwnerMatch
    AllowOverride None

    <IfModule mod_authz_core.c>
      # Apache 2.4
      <RequireAll>
        Require all granted
      </RequireAll>
    </IfModule>

    SetEnv ICINGAWEB_CONFIGDIR "/etc/icingaweb2"

    EnableSendfile Off

    <IfModule mod_rewrite.c>
      RewriteEngine on
      # modified base
      RewriteBase /
      RewriteCond %{REQUEST_FILENAME} -s [OR]
      RewriteCond %{REQUEST_FILENAME} -l [OR]
      RewriteCond %{REQUEST_FILENAME} -d
      RewriteRule ^.*$ - [NC,L]
      RewriteRule ^.*$ index.php [NC,L]
    </IfModule>

    <IfModule !mod_rewrite.c>
      DirectoryIndex error_norewrite.html
      ErrorDocument 404 /error_norewrite.html
    </IfModule>
  </Directory>

  # enable HTTP/2, if available
  Protocols h2 http/1.1

  # HTTP Strict Transport Security (mod_headers is required) (63072000 seconds)
  Header always set Strict-Transport-Security "max-age=63072000"

</VirtualHost>

## Generated by: https://ssl-config.mozilla.org/#server=apache&version=2.4.39&config=modern&openssl=1.1.1d&guideline=5.6

SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1 -TLSv1.2
SSLHonorCipherOrder     off
SSLSessionTickets       off
SSLUseStapling On
SSLStaplingCache "shmcb:logs/ssl_stapling(32768)"